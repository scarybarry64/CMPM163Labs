<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Lab 5c: Rainbow Batman Symbol!</title>
    <style>
        body {
            margin: 0;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <script src="../three.js-master/build/three.js"></script>
    <script>

        // Setup the scene
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75,
            window.innerWidth / window.innerHeight, 0.1, 1000);
        var renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        camera.position.z = 7;

        // Generate particles array; stores position, velocity, and acceleration
        particles = []
        const geo = new THREE.Geometry()
        for (let i = 0; i < 15000; i++) {
            const particle = {
                position: new THREE.Vector3(
                    Math.random() * 2 - 1,
                    Math.random() * 2 - 1,
                    Math.random() * 3 - 3),
                velocity: new THREE.Vector3(
                    Math.random() * .02 - .01,
                    Math.random() * .02 - .01,
                    0),
                acceleration: new THREE.Vector3(
                    Math.random() * .002 - .001,
                    Math.random() * .002 - .001,
                    0),
            }
            particles.push(particle);
            geo.vertices.push(particle.position)
        }

        // Add particles to scene, using Part2a texture
        var sprite = new THREE.TextureLoader().load('disc.png');
        var material = new THREE.PointsMaterial({
            size: 5,
            sizeAttenuation: false, map: sprite, alphaTest: 0.5,
            transparent: true
        });
        material.color.setHSL(1.0, 0.3, 0.7);
        var mesh = new THREE.Points(geo, material);
        scene.add(mesh);

        // "Bat-math": https://math.stackexchange.com/questions/54506/is-this-batman-equation-for-real
        function eq1(x, y) {
            return ((x / 7) * (x / 7) * (Math.sqrt((Math.abs(Math.abs(x) - 3)) / (Math.abs(x) - 3))) + (y / 3) * (y / 3)
                * (Math.sqrt(Math.abs(y + 3 * (Math.sqrt(33) / 7)) / (y + 3 * (Math.sqrt(33) / 7)))) - 1);
        }
        function eq2(x, y) {
            return (Math.abs(x / 2) - ((3 * Math.sqrt(33) - 7) / 112) * x * x - 3 + Math.sqrt(1 - (Math.abs(Math.abs(x) - 2) - 1)
                * (Math.abs(Math.abs(x) - 2) - 1)) - y);
        }
        function eq3(x, y) {
            return (9 * Math.sqrt(Math.abs((1 - Math.abs(x)) * (Math.abs(x) - 0.75)) / ((1 - Math.abs(x)) * (Math.abs(x) - 0.75)))
                - 8 * Math.abs(x) - y);
        }
        function eq4(x, y) {
            return (3 * Math.abs(x) + 0.75 * Math.sqrt(Math.abs((0.75 - Math.abs(x)) * (Math.abs(x) - 0.5)) / ((0.75 - Math.abs(x))
                * (Math.abs(x) - 0.5))) - y);
        }
        function eq5(x, y) {
            return (2.25 * Math.sqrt(Math.abs((0.5 - x) * (x + 0.5)) / ((0.5 - x) * (x + 0.5))) - y);
        }
        function eq6(x, y) {
            return ((6 * Math.sqrt(10)) / 7 + (1.5 - 0.5 * Math.abs(x)) * Math.sqrt(Math.abs(Math.abs(x) - 1) / (Math.abs(x) - 1))
                - ((6 * Math.sqrt(10)) / 14) * Math.sqrt(4 - (Math.abs(x) - 1) * (Math.abs(x) - 1)) - y);
        }

        // Animate the Batman symbol!
        function animate() {

            // Update per particle
            particles.forEach(p => {

                // Use Bat-math to bind the particles within the Bat-bounds
                if (eq1(p.position.x, p.position.y) >= 0 || eq2(p.position.x, p.position.y) >= 0 ||
                    eq3(p.position.x, p.position.y) <= 0 || eq4(p.position.x, p.position.y) <= 0 ||
                    eq5(p.position.x, p.position.y) <= 0 || eq6(p.position.x, p.position.y) <= 0 ||
                    Math.abs(p.position.x) > 6 || Math.abs(p.position.y) > 3) {

                    // If outta the Bat-bounds, randomly generate new position
                    p.position.x = Math.random() * 6;
                    p.position.y = Math.random() * 1;
                    p.position.z = Math.random() * 3 - 3;
                    if (Math.random() > 0.5) {
                        p.position.x *= -1;
                    }
                    if (Math.random() > 0.5) {
                        p.position.y += -1;
                    }

                }

                // Move particles and randomly change colors
                p.position.add(p.velocity);
                if (Math.random() > 0.99999) {
                    material.color.setHSL(Math.random(), Math.random(), Math.random());
                }

            });

            // Rendering stuff
            mesh.geometry.verticesNeedUpdate = true;
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        // I'M BATMAN!!!!!
        animate();

    </script>
</body>

</html>